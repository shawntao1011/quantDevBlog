[{"content":"Notes on using cmake.\nGonna explain and document follow a PREP( POINT REASON EXAMPLE POINT ) style.\nHow to copy the runTime dll 1 2 3 4 add_custom_command(TARGET targetName POST_BUILD COMMAND ${CMAKE_COMMAND} -E copy -t $\u0026lt;TARGET_FILE_DIR:targetName\u0026gt; $\u0026lt;TARGET_RUNTIME_DLLS:targetName\u0026gt; COMMAND_EXPAND_LISTS ) For windows, a dynamic library consists of two files(xxx.lib file and xxx.dll). The .lib file is required when linking to corresponding exe and library. The .lib is useless during RUNTIME. The .dll file is required during RUNTIME, to run executable or run cmake test, we need to copy the .dll to the corresponding exe directory.\nHow to add precompiled lib? 1 2 3 4 5 6 7 8 9 10 11 12 add_library( libName [SHARED|STATIC] IMPORTED ) # linux set_property(TARGET libName PROPERTY IMPORTED_IMPLIB [pathToLibDir]/officialLibName.[a|so]) # windows set_property(TARGET libName PROPERTY IMPORTED_IMPLIB [pathToLibDir]/officialLibName.lib) set_property(TARGET libName PROPERTY IMPORTED_LOCATION [pathToLibDir]/officialDllName.dll) Though vcpkg and linux package provide us with good and easy method to download package, which can be easy find through cmake find_package, the following occasion require to use other method to find a library and link to it:\nlink to a precomiled lib or library not available through package manage system. For instance, Solace library is not available through vcpkg or apt-get. The downloaded file will contain the lib and dll we need. File tree:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 solclient-[version] |---bin |---win32 |---solclient.dll |---win64 |---solclient.dll |---include |---solclient.h |---solclientMsg.h |---lib |---win32 |---solclient.lib |---win64 |---solclient.lib Take windows x64 build for example, the CMakeLists.txt will be:\n1 2 3 4 5 6 7 8 9 10 11 12 13 add_library( SOLACE_LIB SHARED IMPORTED) set_property(TARGET SOLACE_LIB PROPERTY IMPORTED_IMPLIB .../solclient-[version]/${CMAKE_GENERATER_PLATFORM}/lib/solclient.lib) set_property(TARGET libName PROPERTY IMPORTED_LOCATION .../solclient-[version]/${CMAKE_GENERATER_PLATFORM}/lib/solclient.dll) target_include_directories( targetName [PRIVATE|PUBLIC|INTERFACE] .../solclient-[version]/include) target_link_libraries(targetName SOLACE_LIB) find_package fail to find the correct dll. Take zlib for example, the following cmake steps work as expected.\n1 2 3 4 find_library(ZLIB REQUIRED) ... target_link_libraries( targetName ZLIB::ZLIB) However, when it comes to coping the dll, cmake will fail to find the correct one as zlib\u0026rsquo;s dll name is not exactly zlib.dll( Release mode: zlib1.dll Debug mode: zlibd1.dll ).\nIn this scenario, whether to switch from find_package to add_library is up to one\u0026rsquo;s favor.\n","date":"2024-01-04T00:00:00Z","image":"https://shawntao1011.github.io/quantDevBlog/p/cmake-tips/images/CMakeLogo.svg","permalink":"https://shawntao1011.github.io/quantDevBlog/p/cmake-tips/","title":"CMake Tips"},{"content":"My notes on building and using Pulsar on windows.\nPulsar git: https://github.com/apache/pulsar-client-cpp.git\nPulsar cpp client: https://github.com/apache/pulsar-client-cpp.git\nBuild on windows The official buidling guide is to RUN vcpkg first 1 [Your path to vcpkg repo]\\vcpkg.exe install --feature-flags=manifests --triplet x64-windows and then run the following:\n1 2 3 4 5 6 7 8 9 cmake \\ -B ./build \\ -A x64 \\ -DBUILD_TESTS=OFF \\ -DVCPKG_TRIPLET=x64-windows \\ -DCMAKE_BUILD_TYPE=Release \\ -DCMAKE_TOOLCHAIN_FILE=[vcpkgPath]/vcpkg.cmake -S . cmake --build ./build --config Release However, this method will generate two vcpkg directories to manage, which are ${PROJECT_SOURCE_DIR} and ${CMAKE_CURRENT_BINARY_DIR}.\nThe above package install method is much like JS package managing method, which managing package dependency for each project. In favor of using Linux method, I recommend vcpkg install all the package under vcpkg directory.\nBy default, if there is a vcpkg.json file under the ${PROJECT_SOURCE_DIR}, then vcpkg will use the MANIFEST mode. To clarify, vcpkg will check what package is available in ${VCPKG_INSTALLEd_DIR}, and install missing package under ${CMAKE_CURRENT_SOURCE_DIR}.\n","date":"2024-01-02T00:00:00Z","image":"https://shawntao1011.github.io/quantDevBlog/p/pulsar-build/images/pulsarLogo.svg","permalink":"https://shawntao1011.github.io/quantDevBlog/p/pulsar-build/","title":"pulsar build"},{"content":"My notes on learning network programming. This post is mainly on concepts and examples from\nBeej\u0026rsquo;s Guide to Network Programming Using Internet Sockets\nThe original Beej\u0026rsquo;s guide only provide Unix/Linux source code examples. Windows example src, mentioned in Beej\u0026rsquo;s guide, is provided on\nBeej\u0026rsquo;s Socket examples ported to windows\nStructs and functions addrinfo: one of the first thing to call when making a connection 1 2 3 4 5 6 7 8 9 10 struct addrinfo { int ai_flags; // AI_PASSIVE, AI_CANONNAME, etc. int ai_family; // AF_INET, AF_INET6, AF_UNSPEC int ai_socktype; // SOCK_STREAM, SOCK_DGRAM int ai_protocol; // use 0 for \u0026#34;any\u0026#34; size_t ai_addrlen; // size of ai_addr in bytes struct sockaddr *ai_addr; // struct sockaddr_in or _in6 char *ai_canonname; // full canonical hostname struct addrinfo *ai_next; // linked list, next node }; Note: the ai_next is a linked list to next node\nwhere struct sockaddr is :\n1 2 3 4 struct sockaddr { unsigned short sa_family; // address family, AF_xxx char sa_data[14]; // 14 bytes of protocol address }; The sa_family can be set to AF_INET (IPV4) or AF_INET6 (IPV6).\nSince the sa_data is not going to be manually packed. Programmers created a parallel structure sockaddr_in to be used with IPv4.\nAnd here is the trick: a pointer to a struct sockaddr_in\n1 struct sockaddr_in addr = {...} can be cast to a pointer to a struct sockaddr and vice-versa\n1 (const struct sockaddr*)\u0026amp;addr So, even a function call requires \u0026ldquo;a pointer to a struct sockaddr\u0026rdquo;, we can still work on sockaddr_in at the last minutes.\nFor instance:\n1 2 3 4 5 6 7 // bind socket fd struct sockaddr_in addr = {}; addr.sin_fmily = AF_INET; addr.sin_port = noths(12345); addr.sin_addr.s_addr = ntohl(0); int res = bind(fd, (const sockadr*)\u0026amp;addr, sizeof(addr)); The struct sockaddr_in:\n1 2 3 4 5 6 7 8 9 10 11 12 // (IPv4 only--see struct sockaddr_in6 for IPv6) struct sockaddr_in { short int sin_family; // Address family, AF_INET unsigned short int sin_port; // Port number struct in_addr sin_addr; // Internet address unsigned char sin_zero[8];// Same size as struct sockaddr }; // Internet address (a structure for historical reasons) struct in_addr { uint32_t s_addr; // that\u0026#39;s a 32-bit int (4 bytes) }; ","date":"2023-11-17T00:00:00Z","image":"https://shawntao1011.github.io/quantDevBlog/p/network-programming-concepts/images/networkProgrammingConcepts_hued4765b18cc282e3c17fa32fbcd03722_129719_120x120_fill_box_smart1_3.png","permalink":"https://shawntao1011.github.io/quantDevBlog/p/network-programming-concepts/","title":"network programming concepts"},{"content":"Torq, mainly the torq.q, is a framework provided by Data Intellect. It implements some core functionality and utilities on top of kdb+, allowing developers to concentrate on the application business logic.\nQuick Deploy For a minimized TorQ deployment with appliable business logic, the following components(processes) should be configured:\ndiscovery\n\u0026ldquo;Processes use the discovery service to register their own availability, find other processes (by process type) and subscribe to receive updates for new process availability (by process type).\u0026rdquo;\nThe following are some important facts of discovery service:\nThe tickerplant process, which is the most important part of the whole pipeline system, is not (and shall not) registered or informed through discovery service.\nThe raw discovery mainly focus on the following information\n1 2 3 4 5 6 7 8 q).servers.SERVERS procname proctype hpup w hits startp lastp endp attributes -------------------------------------------------------------------------------------------------------------- discovery-1 discovery :laptop-emhga05g:11001 0 2023.10.24D03:32:29.291568000 ()!() monitor-1 monitor :laptop-emhga05g:11000 0 2023.10.24D03:32:30.117205000 ()!() tickerplant-mkt tickerplant :laptop-emhga05g:11002 0 2023.10.24D03:32:30.117205000 ()!() gateway-1 gateway :laptop-emhga05g:11003 0 2023.10.24D03:32:30.117205000 ()!() rdb-1 rdb :laptop-emhga05g:11004 0 2023.10.24D03:32:30.117205000 ()!() monitor\ntickerplant\ngateway\nrdb\n","date":"2023-10-19T00:00:00Z","image":"https://shawntao1011.github.io/quantDevBlog/p/torq-notes/images/torQLogo_hu11988cbff700bbdba3f69e3fb5b7c138_15532_120x120_fill_box_smart1_3.png","permalink":"https://shawntao1011.github.io/quantDevBlog/p/torq-notes/","title":"torQ notes"},{"content":"test detail and environment Test data is a txt file of 2 million rows of Json. The json are consist of jsonlized Ticks and Txns data.\nsample(one json one row):\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 \u0026#34;{ \u0026#34;date\u0026#34;:\u0026#34;yyyy-mm-ddThh:mm:ss.sssssssss\u0026#34;, \u0026#34;sym\u0026#34;:\u0026#34;xxxxxx.xx\u0026#34;, \u0026#34;time\u0026#34;:\u0026#34;yyyy-mm-ddThh:mm:ss.sssssssss\u0026#34;, \u0026#34;ticker\u0026#34;:\u0026#34;xxxxxx\u0026#34;, \u0026#34;side\u0026#34;:\u0026#34;N\u0026#34;, \u0026#34;px\u0026#34;:0, \u0026#34;size\u0026#34;:xxx, \u0026#34;index\u0026#34;:xxxxxx, \u0026#34;askId\u0026#34;:0, \u0026#34;bidId\u0026#34;:xxxxxx, \u0026#34;ordType\u0026#34;:\u0026#34;0\u0026#34;, \u0026#34;func\u0026#34;:\u0026#34;C\u0026#34; }\u0026#34;, \u0026#34;{ \u0026#34;date\u0026#34;:\u0026#34;yyyy-mm-ddThh:mm:ss.sssssssss\u0026#34;, \u0026#34;sym\u0026#34;:\u0026#34;xxxxxx.xx\u0026#34;, \u0026#34;time\u0026#34;:\u0026#34;yyyy-mm-ddThh:mm:ss.sssssssss\u0026#34;, \u0026#34;open\u0026#34;:xx.xx, \u0026#34;high\u0026#34;:xx.xx, \u0026#34;low\u0026#34;:xx.xx, \u0026#34;preclose\u0026#34;:xx.xx, \u0026#34;px\u0026#34;:xx.xx, \u0026#34;match\u0026#34;:xxxx, \u0026#34;volume\u0026#34;:xxxxxx, \u0026#34;amt\u0026#34;:xxxxxxx, \u0026#34;asks\u0026#34;:[xx.89,xx.9,xx.91,xx.93,xx.94,xx.95,xx.96,xx.97,xx.99,xx], \u0026#34;avgAsk\u0026#34;:xx.xx, \u0026#34;askSizes\u0026#34;:[4800,75300,300,1600,5200,5000,5100,300,3800,104446],\u0026#34;totalAskSize\u0026#34;:xxxxxx, \u0026#34;bids\u0026#34;:[xx.88,xx.87,xx.86,xx.85,xx.84,xx.83,xx.82,xx.81,xx.8,xx.79], \u0026#34;avgBid\u0026#34;:xx.xx, \u0026#34;bidSizes\u0026#34;:[2500,1800,500,5900,6500,3600,2000,6200,18700,4000],\u0026#34;totalBidSize\u0026#34;:xxxxxx, \u0026#34;presettle\u0026#34;:null, \u0026#34;settle\u0026#34;:null }\u0026#34; q tickerplant Tickerplant is on a remote server. Log writing is performed exactly on the same server(which means local).\nFH, RDB, RTS publish and subscribe data through KDB Q IPC.\nPerformance Highlights Pub Speed: 1 million msgs 6 second\nDeserialize no need to deserialize\nReplay 1 million msgs 10 second\nfeeder tp rdb run.cmd kafka Kafka server is on the same host with tickerplant.\nPubSub is performed remotely in the same local network.\nüê£ kx kafka library\nPerformance Highlights Pub Speed: 1 million msgs 7.5 second\nDeserialize: 1 million msgs 36 second\nConsume Speed: 1 million msgs total 50 second, include deserialize and upd to table.\nReplay performance performance is exactly the same as consumer.\nfeeder kafka server To download kafka, please take reference kafka quick setup.\nZookeeper and a Kafka broker are initialized using the following commands.\nzookeeper:\n1 bin\\windows\\zookeeper-server-start.bat config\\zookeeper.properties The server need to add advertised.listeners=PLAINTEXT://your.host.name:9092\n1 bin\\windows\\kafka-server-start.bat config\\server.properties consumer replay replay in kafka requires to change the client config. The other is exactly the same as start a consumer.\n1 2 3 4 5 6 client: .kfk.Consumer[ .... (`group.id;`new port number); //(`auto.offset.reset;`latest) (`auto.offset.reset;`earliest) ]; solace üê£ solace container guide\nüê• solace kx library\nPerformance Highlights Pub Speed: 1 million msgs 55 second\nDeserialize: 1 million msgs 36 second\nConsume Speed: 1 million msgs total 1min45s, include deserialize and upd to table.\nReplay performance 1 millon msgs 150 seconds\nproducer solace instant 1 docker run -d -p 8080:8080 -p 55555:55555 -p 8008:8008 -p 1883:1883 -p 8000:8000 -p 5672:5672 -p 9000:9000 -p 2222:2222 --shm-size=2g --env username_admin_globalaccesslevel=admin --env username_admin_password=admin --name=solace solace/solace-pubsub-standard consumer replay ","date":"2023-09-27T00:00:00Z","image":"https://shawntao1011.github.io/quantDevBlog/p/messaging-solutions-performance-for-kdb-arch/images/streaming_hu4434ecd02d39b32d498d62d9f67f83f6_40518_120x120_fill_q75_box_smart1.jpg","permalink":"https://shawntao1011.github.io/quantDevBlog/p/messaging-solutions-performance-for-kdb-arch/","title":"messaging solutions' performance for kdb arch"},{"content":"This is my deployment of kdb q.\nLinux deployment Reference on how to have multiple version of kdb (kdb version and bit version): multiVersion\nsample dir:\n1 2 3 4 5 6 7 8 9 10 11 12 13 $ tree q q ‚îú‚îÄ‚îÄ k4.lic ‚îú‚îÄ‚îÄ v3.5 ‚îÇ ‚îú‚îÄ‚îÄ m32 ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ q ‚îÇ ‚îú‚îÄ‚îÄ m64 ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ q ‚îÇ ‚îî‚îÄ‚îÄ q.k ‚îî‚îÄ‚îÄ v4.0 ‚îú‚îÄ‚îÄ m64 ‚îÇ ‚îî‚îÄ‚îÄ q ‚îî‚îÄ‚îÄ q.k In this environment, two version of 64 bit q binary and one 32 bit q binary are available. But the\n1 q command will call the one with alias. To have access to multiple version access, we can set alias shortcut as q32 q64 etc.\n1 2 3 4 export QLIC=~/q alias q=\u0026#39;export QHOME=~/q/v4.0; rlwrap -r $QHOME/m64/q\u0026#39; alias q3.5=\u0026#39;export QHOME=~/q/v3.5; rlwrap -r $QHOME/m64/q\u0026#39; alias q32=\u0026#39;export QHOME=~/q/v3.5; rlwrap -r $QHOME/m32/q\u0026#39; windows deployment Windows defers from Linux, environment varibale redefine requires shell to reopen.\nWe need to set different environment to start correspnoding q.exe.\nThe \u0026ldquo;QHOME\u0026rdquo; envrionment is the core to startup a q.exe, as it not only defines the loading directory but also determines the q.exe path.\nAdd the following to path:\n1 %QHOME%/w32 ","date":"2023-09-14T00:00:00Z","image":"https://shawntao1011.github.io/quantDevBlog/p/kdb-q-deployment/images/kdbinfo_hub32641a6239649881d9d9130e34b5ea6_203368_120x120_fill_box_smart1_3.png","permalink":"https://shawntao1011.github.io/quantDevBlog/p/kdb-q-deployment/","title":"KDB Q deployment"}]